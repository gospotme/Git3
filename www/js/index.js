
/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
var app = {
    // Application Constructor
    initialize: function() {
        this.bindEvents();
    },
    // Bind Event Listeners
    //
    // Bind any events that are required on startup. Common events are:
    // 'load', 'deviceready', 'offline', and 'online'.
    bindEvents: function() {
        document.addEventListener('deviceready', this.onDeviceReady, false);
    },
    // deviceready Event Handler
    //
    // The scope of 'this' is the event. In order to call the 'receivedEvent'
    // function, we must explicitly call 'app.receivedEvent(...);'
    onDeviceReady: function() {
        app.receivedEvent('deviceready');
    },
    // Update DOM on a Received Event
    receivedEvent: function(id) {
        var parentElement = document.getElementById(id);
        var listeningElement = parentElement.querySelector('.listening');
        var receivedElement = parentElement.querySelector('.received');

        listeningElement.setAttribute('style', 'display:none;');
        receivedElement.setAttribute('style', 'display:block;');

        console.log('Received Event: ' + id);
    }
};

var btnGetCurrentLocation=null,divCurrentLocation=null,CurrentLocation=null,btnSaveCurrentLocation=null,tblSavedLocations=null,SavedLocationForGPS=null,watchPositionId=null,WebSiteURL="http://www.gospotme.com",MaxAccuracyThreshold=1,MaxPositionCount=25,PositionCounter=0,FeetInMeter=3.28084,MapHeight="250px",DEBUG_MODE=!1,Maps=[],Markers=[],Circles=[],InfoWindows=[],SavedLocations=[],IsiOS=/iPhone|iPad|iPod/i.test(navigator.userAgent),IsMobileDevice=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
VerifyDomainUrl=function(){if(DEBUG_MODE)return!0;var b=GetDomainParts(),c=!1;"www"!=b.SubDomain?c=!0:"gospotme"!=b.Domain?c=!0:"com"!=b.Ext&&(c=!0);return!0==c?(document.location=WebSiteURL,!1):!0},body_OnLoad=function(){if(!1!=VerifyDomainUrl())if(btnGetCurrentLocation=document.getElementById("btnGetCurrentLocation"),divCurrentLocation=document.getElementById("divCurrentLocation"),btnSaveCurrentLocation=document.getElementById("btnSaveCurrentLocation"),tblSavedLocations=document.getElementById("tblSavedLocations"),
SetCurrentLocationMapVisible(!1),btnGetCurrentLocation.style.visibility="",btnGetCurrentLocation.style.position="",navigator.geolocation)if(btnGetCurrentLocation.disabled=!1,btnGetCurrentLocation.onclick=btnGetCurrentLocation_OnClick,btnSaveCurrentLocation.onclick=btnSaveCurrentLocation_OnClick,"undefined"===typeof Storage)alertify.alert("Your browser doesn't support local storage."),btnGetCurrentLocation.disabled=!1;else if(JSON){var b=localStorage.getItem("SpotrSavedLocations");SavedLocations=b?
JSON.parse(b):[];PopulateSavedLocations();CheckForImport()}else alertify.alert("Your browser doesn't have native JSON support."),btnGetCurrentLocation.disabled=!1;else btnGetCurrentLocation.disabled=!0,btnGetCurrentLocation.value="Go Spot Me! (Your device does not support GPS)"},CheckForImport=function(){var b=null,c="",d="",a=0,e=0,f=new Date,k=-1,c=QueryString("id");""!=c&&(b=GetSavedLocation(c),null!=b?setTimeout(function(){ShowSavedLocation(b.Id)},50):(d=QueryString("desc"),a=parseFloat(QueryString("lat")),
e=parseFloat(QueryString("lng")),k=parseInt(QueryString("accuracy")),b={Id:c,Desc:d,Pos:{Lat:a,Lng:e},UTC:f.toISOString(),IsCurrent:!1,Accuracy:k,BitLyUrl:""},b.BitLyUrl=GetLocationBitLyUrl(b),null==SavedLocations&&(SavedLocations=[]),SavedLocations.push(b),SaveSavedLocations(),PopulateSavedLocation(b,!0)))},QueryString=function(b){b=b.toLowerCase().replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");b=RegExp("[\\?&]"+b+"=([^&#]*)").exec(location.search);return null==b?"":decodeURIComponent(b[1].replace(/\+/g,
" "))},GetDomainParts=function(){var b=window.location.host.split(".");return{SubDomain:b[0],Domain:b[1],Ext:b[2],Type:b[3]}},GeoLocationOptions={maximumAge:0,timeout:3E4,allowHighAccuracy:!0,enableHighAccuracy:!0},btnGetCurrentLocation_OnClick=function(){navigator.geolocation&&(!0==GetCurrentLocationMapVisible()?(watchPositionId&&(navigator.geolocation.clearWatch(watchPositionId),watchPositionId=null),btnGetCurrentLocation.value="Go Spot Me!",SetCurrentLocationMapVisible(!1),btnGetCurrentLocation.disabled=
!1):(btnGetCurrentLocation.value="Getting Your Location...",btnGetCurrentLocation.disabled=!0,SetCurrentLocationMapVisible(!1),watchPositionId&&(navigator.geolocation.clearWatch(watchPositionId),watchPositionId=null),watchPositionId=navigator.geolocation.watchPosition(function(b){CurrentPosition_OnSuccess3(b,!1)},CurrentPosition_OnError,GeoLocationOptions)))},SetCurrentLocationMapVisible=function(b){!0==b&&"0px"==divCurrentLocation.style.height?(btnSaveCurrentLocation.style.visibility="",btnSaveCurrentLocation.style.position=
""):!1==b&&"0px"!=divCurrentLocation.style.height&&(HideGoogleMap(CurrentLocation,divCurrentLocation),btnGetCurrentLocation.disabled=!0,btnSaveCurrentLocation.style.visibility="hidden",btnSaveCurrentLocation.style.position="absolute")},GetCurrentLocationMapVisible=function(){return"0px"!=divCurrentLocation.style.height},CurrentPosition_OnError=function(b){var c="An unknown error occurred.";switch(b.code){case b.PERMISSION_DENIED:c="User denied the request for Geolocation.";break;case b.POSITION_UNAVAILABLE:c=
"Location information is unavailable.";break;case b.TIMEOUT:c="The request to get user location timed out."}SetCurrentLocationMapVisible(!1);btnGetCurrentLocation.value="Go Spot Me!";btnGetCurrentLocation.disabled=!1;alertify.alert(c)},CurrentPosition_OnSuccess=function(b){var c=new Date,d=b.coords.latitude,a=b.coords.longitude;b=b.coords.accuracy;CurrentLocation={Id:c.getTime().toString(),UTC:c.toISOString(),Pos:{Lat:d,Lng:a},Desc:"You are here!",IsCurrent:!0,Accuracy:b,BitLyUrl:""};"Go Spot Me"!=
btnGetCurrentLocation.value&&(btnGetCurrentLocation.value="Don't Spot Me",SetCurrentLocationMapVisible(!0),ShowGoogleMap(CurrentLocation,divCurrentLocation));RefreshCurrentLocationOnSavedLocations()},HideGoogleMap=function(b,c,d){d="-1";var a=null,e=null,f=null;b&&!b.IsCurrent&&(d=b.Id);a=Markers[d];e=Circles[d];f=InfoWindows[d];a&&a.setVisible(!1);f&&f.close();e&&e.setVisible(!1);b=d+":2";e=a=d=null;d=Markers[b];a=Circles[b];e=InfoWindows[b];d&&d.setVisible(!1);e&&e.close();a&&a.setVisible(!1);c.style.height=
"0px"},ShowGoogleMap=function(b,c,d){var a=b.Accuracy,e=new google.maps.LatLng(b.Pos.Lat,b.Pos.Lng),f="-1",k=null,m=null,g=null,p=null;c.cssClass="ShowCurrentLocation";g="0px"==c.style.height;c.style.height=MapHeight;c.style.width="100%";if(!0==g)setTimeout(function(){ShowGoogleMap(b,c,d)},500),setTimeout(function(){window_OnResize()},500);else{b.IsCurrent||(f=b.Id);k=Maps[f];m=Markers[f];g=Circles[f];p=InfoWindows[f];k||(k=new google.maps.Map(c,{center:e,zoom:20,mapTypeId:google.maps.MapTypeId.HYBRID,
mapTypeControl:!0,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL},draggable:!1}),Maps[f]=k);if(!m){var h={map:k,position:e,zIndex:0,visible:!1,icon:{url:"saved.png"}};b.IsCurrent&&(h.icon.url="current.png");m=new google.maps.Marker(h);Markers[f]=m}!1==m.getVisible()&&(m.setAnimation(google.maps.Animation.DROP),m.setVisible(!0));p||(h={position:e,content:"<a href='"+GetGoogleMapsURL(b)+"' target='_blank'>"+b.Desc+"</a>"},p=new google.maps.InfoWindow(h),InfoWindows[f]=p,google.maps.event.addListener(m,
"click",function(){p.open(k,m)}));p.setContent("<a href='"+GetGoogleMapsURL(b)+"' target='_blank'>"+b.Desc+"</a>");g||(g={map:k,visible:!1,posicentertion:e,fillColor:"#A0FFA0",fillOpacity:0.5,radius:a,strokeWeight:1,strokeColor:"#408040",strokeOpacity:1},b.IsCurrent&&(g.fillColor="#A0A0FF",g.strokeColor="#404080"),g=new google.maps.Circle(g),Circles[f]=g);!1==g.getVisible()&&g.setVisible(!0);g.radius=a;g.setCenter(e);m.setPosition(e);k.setCenter(e);if(d){var f=d.Accuracy,a=new google.maps.LatLng(d.Pos.Lat,
d.Pos.Lng),g=b.Id+":2",l=Markers[g],h=Circles[g],n=InfoWindows[g];if(!l){var q={map:k,position:a,zIndex:1,visible:!1,icon:{url:"saved.png"}};d.IsCurrent&&(q.icon.url="current.png");l=new google.maps.Marker(q);Markers[g]=l}!1==l.getVisible()&&(l.setAnimation(google.maps.Animation.DROP),l.setVisible(!0));n||(q={position:a,content:"<a href='"+GetGoogleMapsURL(d)+"' target='_blank'>"+d.Desc+"</a>"},n=new google.maps.InfoWindow(q),InfoWindows[g]=n,google.maps.event.addListener(l,"click",function(){n.open(k,
l)}));n.setContent("<a href='"+GetGoogleMapsURL(d)+"' target='_blank'>"+d.Desc+"</a>");h||(h={map:k,visible:!1,posicentertion:a,fillColor:"#A0FFA0",fillOpacity:0.5,radius:f,strokeWeight:1,strokeColor:"#408040",strokeOpacity:1},d.IsCurrent&&(h.fillColor="#A0A0FF",h.strokeColor="#404080"),h=new google.maps.Circle(h),Circles[g]=h);!1==h.getVisible()&&h.setVisible(!0);h.radius=f;h.setCenter(a);l.setPosition(a);f=new google.maps.LatLng(a.lat()>e.lat()?a.lat():e.lat(),a.lng()<e.lng()?a.lng():e.lng());e=
new google.maps.LatLng(a.lat()<e.lat()?a.lat():e.lat(),a.lng()>e.lng()?a.lng():e.lng());e=new google.maps.LatLngBounds(f,e);k.fitBounds(e);k.setCenter(e.getCenter())}else g=b.Id+":2",l=Markers[g],h=Circles[g],n=InfoWindows[g],l&&l.setVisible(!1),n&&n.close(),h&&h.setVisible(!1)}},btnSaveCurrentLocation_OnClick=function(){watchPositionId&&(navigator.geolocation.clearWatch(watchPositionId),watchPositionId=null);alertify.prompt2("Please enter a description (Ie: Parking Space #11)",function(b,c){b?null!=
c&&""!=c.trim()&&btnSaveCurrentLocation_OnClick2(c):(SetCurrentLocationMapVisible(!1),btnGetCurrentLocation_OnClick())},"")};alertify.prompt2=function(b,c,d){var a=null,a=alertify.prompt(b,c,d);SetFocusToAterifyPrompt();return a};
var SetFocusToAterifyPrompt=function(){var b=document.getElementById("alertify-text");null!=b&&(b.select(),b.focus())},btnSaveCurrentLocation_OnClick2=function(b){var c=new Date,d=null,d=JSON.parse(JSON.stringify(CurrentLocation));d.UTC=c.toISOString();d.Desc=b;d.IsCurrent=null;d.BitLyUrl=GetLocationBitLyUrl(d);null==SavedLocations&&(SavedLocations=[]);SavedLocations.push(d);SaveSavedLocations();watchPositionId&&(navigator.geolocation.clearWatch(watchPositionId),watchPositionId=null);SetCurrentLocationMapVisible(!1);
btnGetCurrentLocation.disabled=!1;btnGetCurrentLocation.value="Go Spot Me!";PopulateSavedLocation(d,!1);ShowSavedLocation(d.Id)},SaveSavedLocations=function(){var b="";0==SavedLocations.length?localStorage.removeItem("SpotrSavedLocations"):(b=JSON.stringify(SavedLocations),localStorage.setItem("SpotrSavedLocations",b))},PopulateSavedLocations=function(){var b,c;for(c=0;c<=tblSavedLocations.rows.length-1;c++)tblSavedLocations.deleteRow(c);for(c=0;c<=SavedLocations.length-1;c++)b=SavedLocations[c],
PopulateSavedLocation(b)},PopulateSavedLocation=function(b,c){var d=null,d=null,a;a="   <div class='divBuf'></div>\r\n   <div class='divHr'></div>\r\n";a+="   <div class='divBuf'></div>\r\n";a+="<table id='tblParentSavedLocation"+b.Id+"' style='width: 100%'>";a+=" <tr><td style='width: 1px'>\r\n";a+="   <a id='aShowSavedLocation"+b.Id+"' href='#' onclick='javascript: ShowSavedLocation(\""+b.Id+"\"); return false;'><img id='imgShowSavedLocationDown"+b.Id+"' src='down.png' /><img id='imgShowSavedLocationUp"+
b.Id+"' src='up.png' style='visibility: hidden; position: absolute;' /></a>\r\n";a+="  </td>\r\n";a+="  <td style='width: 100%'>\r\n";a+="   <a href='#'onclick='javascript: UpdateSavedLocation(\""+b.Id+"\"); return false;' style='text-decoration: none; color: black;'><span id='lblDesc"+b.Id+"'>"+b.Desc+"</span></a>\r\n";a+="  </td>\r\n";a+="  <td style='width: 1px'>\r\n";a+="   <a href='#' onclick='javascript: DeleteSavedLocation(\""+b.Id+"\"); return false;'><img src='delete.png' /></a>\r\n";a+=
"  </td></tr></table>\r\n";a+=" </tr>\r\n";a+="</table>\r\n";a+="<table id='tblSavedLocation"+b.Id+"' style='width: 100%; visibility: hidden; position: absolute; height: 0px;' class='SavedLocationTable'>";a+=" <tr><td>\r\n";a+="<table style='width: 100%'>";a+=" <tr><td>\r\n";a+="  <table style='width: 100%'><tr><td style='width: 50%'>\r\n";a+="   <input type='button' style='width: 100%' id='btnShowCurrentLocation"+b.Id+"' value='Go Spot Me!' onclick='javascript: ShowCurrentLocation(\""+b.Id+"\");' />\r\n";
a+="  </td>\r\n";a+="  <td style='width: 50%'>\r\n";a+="   <input type='button' style='width: 100%' id='btnGetDirections"+b.Id+"' value='Get Directions' onclick='javascript: FindSavedLocation(\""+b.Id+"\");' />\r\n";a+="  </td></tr></table>\r\n";a+=" </td></tr>\r\n";a+=" <tr><td>\r\n";!0==IsiOS?(a+="  <table style='width: 100%'><tr><td style='width: 50%'>\r\n",a+="   <input type='button' style='width: 100%' id='btnShareSavedLocation"+b.Id+"' value='Share' onclick='javascript: ShareSavedLocation(\""+
b.Id+"\");' />\r\n",a+="  </td>\r\n",a+="  <td style='width: 50%'>\r\n"):!1==IsMobileDevice?(a+="  <table style='width: 100%'><tr><td style='width: 50%'>\r\n",a+="   <input type='button' style='width: 100%' id='btnShareSavedLocation"+b.Id+"' value='Share' onclick='javascript: ShareSavedLocation(\""+b.Id+"\");' />\r\n",a+="  </td>\r\n",a+="  <td style='width: 50%'>\r\n"):(a+="  <table style='width: 100%'><tr><td style='width: 33%'>\r\n",a+="   <input type='button' style='width: 100%' id='btnShareSavedLocation"+
b.Id+"' value='Share' onclick='javascript: ShareSavedLocation(\""+b.Id+"\");' />\r\n",a+="  </td>\r\n",a+="  <td style='width: 33%'>\r\n",a+="   <input type='button' style='width: 100%' id='btnTextSavedLocation"+b.Id+"' value='Text' onclick='javascript: TextSavedLocation(\""+b.Id+"\");' />\r\n",a+="  </td>\r\n",a+="  <td style='width: 33%'>\r\n");a+="   <input type='button' style='width: 100%' id='btnEmailSavedLocation"+b.Id+"' value='Email' onclick='javascript: EmailSavedLocation(\""+b.Id+"\");' />\r\n";
a+="  </td></tr></table>\r\n";a+=" </td></tr>\r\n";a+="</table>\r\n";a+="<table style='width: 100%'>\r\n";a+=" <tr>\r\n";a+="  <td>\r\n";a+="   <div id='divMap"+b.Id+"' style='height: 0px;' class='ShowCurrentLocation'></div>";a+="  </td>\r\n";a+=" </tr>\r\n";a+="</table>\r\n";a+=" </td></tr>\r\n";a+="</table>\r\n";d=tblSavedLocations.insertRow(0);d=d.insertCell(0);d.innerHTML=a;document.getElementById("divMap"+b.Id);!0==c&&setTimeout(function(){ShowSavedLocation(b.Id)},50)},GetSavedLocation=function(b){for(var c=
null,d=0,d=0;d<=SavedLocations.length-1;d++)if(c=SavedLocations[d],c.Id==b)return c},DeleteSavedLocation=function(b){alertify.confirm("Are you sure you want to delete this saved location?",function(c){c&&DeleteSavedLocation2(b)})},DeleteSavedLocation2=function(b){for(var c=null,d=-1,c=null,a=0,a=0;a<=SavedLocations.length-1;a++)if(c=SavedLocations[a],c.Id==b){d=a;break}if(-1!=d)for(SavedLocations.splice(d,1),SaveSavedLocations(),a=0;a<=tblSavedLocations.rows.length-1;a++)if(c=tblSavedLocations.rows[a],
-1!=c.cells[0].innerHTML.indexOf(b)){tblSavedLocations.deleteRow(a);break}},ShowSavedLocation=function(b){var c=null,d=null,a=null,e=null,f=null,c=GetSavedLocation(b);null!=c&&(d=document.getElementById("tblSavedLocation"+c.Id),document.getElementById("tblParentSavedLocation"+c.Id),a=document.getElementById("aShowSavedLocation"+c.Id),e=document.getElementById("imgShowSavedLocationDown"+c.Id),f=document.getElementById("imgShowSavedLocationUp"+c.Id),"hidden"==d.style.visibility?(d.style.visibility=
"",d.style.position="",d.style.height=MapHeight,setTimeout(function(){e.style.visibility="hidden";e.style.position="absolute";f.style.visibility="";f.style.position=""},500)):d.style.height==MapHeight&&(d.style.height="0px",setTimeout(function(){d.style.visibility="hidden";d.style.position="absolute"},150),setTimeout(function(){e.style.visibility="";e.style.position="";f.style.visibility="hidden";f.style.position="absolute"},150)),ShowCurrentLocationMap(c.Id),a.onclick=function(){return!1},setTimeout(function(){a.onclick=
function(){ShowSavedLocation(b);return!1}},500))},UpdateSavedLocation=function(b){var c=null,c=GetSavedLocation(b);null!=c&&alertify.prompt2("Update description: ",function(b,a){b&&null!=a&&""!=a.trim()&&UpdateSavedLocation2(c,a)},c.Desc)},UpdateSavedLocation2=function(b,c){var d=b.Id,a=null,a=null;b.Desc=c;SaveSavedLocations();a=document.getElementById("lblDesc"+d);a.innerHTML=b.Desc;a=document.getElementById("divMap"+d);btnShowCurrentLocation=document.getElementById("btnShowCurrentLocation"+d);
document.getElementById("tblSavedLocation"+d);a.style.height==MapHeight&&ShowGoogleMap(b,a,"Don't Spot Me"==btnShowCurrentLocation.value?CurrentLocation:null)},FindSavedLocation=function(b){var c=null,c="",c=GetSavedLocation(b);null!=c&&(c=GetGoogleMapsURL(c),window.open(c,"_blank"))},GetGoogleMapsURL=function(b){return b="https://maps.google.com/?"+("q="+b.Pos.Lat.toString()+","+b.Pos.Lng.toString())},ShowCurrentLocation=function(b){var c=null,d=null,a=null,c=GetSavedLocation(b);null!=c&&(d=document.getElementById("divMap"+
c.Id),a=document.getElementById("btnShowCurrentLocation"+c.Id),null==watchPositionId&&"Go Spot Me!"==a.value?(a.value="Don't Spot Me",btnGetCurrentLocation_OnClick(),setTimeout(function(){d.scrollIntoView()},500)):"Go Spot Me!"==a.value?(ShowGoogleMap(c,d,CurrentLocation),a.value="Don't Spot Me"):(ShowGoogleMap(c,d),a.value="Go Spot Me!"))},ShowCurrentLocationMap=function(b){var c=null,d=null,a=null,c=GetSavedLocation(b);null!=c&&(d=document.getElementById("divMap"+c.Id),a=document.getElementById("btnShowCurrentLocation"+
c.Id),document.getElementById("tblSavedLocation"+b),"0px"==d.style.height?"Go Spot Me!"==a.value?ShowGoogleMap(c,d):ShowGoogleMap(c,d,CurrentLocation):d.style.height==MapHeight&&(HideGoogleMap(c,d,CurrentLocation),a.value="Go Spot Me!"))},CurrentPosition_OnSuccess2=function(b){var c=new Date,d=b.coords.latitude,a=b.coords.longitude;b=b.coords.accuracy;CurrentLocation={Id:c.getTime().toString(),UTC:c.toISOString(),Pos:{Lat:d,Lng:a},Desc:"You are here!",IsCurrent:!0,Accuracy:b,BitLyUrl:""};ShowCurrentLocation(SavedLocationForGPS.Id)},
CurrentPosition_OnSuccess3=function(b,c){var d=new Date,a=b.coords.latitude,e=b.coords.longitude,f=b.coords.accuracy;CurrentLocation={Id:d.getTime().toString(),UTC:d.toISOString(),Pos:{Lat:a,Lng:e},Desc:"You are here!",IsCurrent:!0,Accuracy:f,BitLyUrl:""};c?ShowCurrentLocation(SavedLocationForGPS.Id):("Go Spot Me"!=btnGetCurrentLocation.value&&(SetCurrentLocationMapVisible(!0),setTimeout(function(){btnGetCurrentLocation.value="Don't Spot Me";btnGetCurrentLocation.disabled=!1},500),ShowGoogleMap(CurrentLocation,
divCurrentLocation)),RefreshCurrentLocationOnSavedLocations())},RefreshCurrentLocationOnSavedLocations=function(){for(var b=null,c=0,d=null,a=null,c=0;c<=SavedLocations.length-1;c++)b=SavedLocations[c],d=document.getElementById("divMap"+b.Id),a=document.getElementById("btnShowCurrentLocation"+b.Id),"Don't Spot Me"==a.value&&ShowGoogleMap(b,d,CurrentLocation)},ShareSavedLocation=function(b){SavedLocation=GetSavedLocation(b);null!=SavedLocation&&!1!=VerifyLocationBitLyUrl(SavedLocation)&&(SpotrUrl=
SavedLocation.BitLyUrl,!0==IsMobileDevice?(alertify.prompt2("Please copy the following URL to share this saved spot:",function(){},SavedLocation.BitLyUrl),document.getElementById("alertify-cancel").style.visibility="hidden"):alertify.alert("Please copy the following URL to share this saved spot:\n\n"+SavedLocation.BitLyUrl))},EmailSavedLocation=function(b){var c="",d="",d=null,c="",d=GetSavedLocation(b);null!=d&&!1!=VerifyLocationBitLyUrl(d)&&(d=d.BitLyUrl,c=c+("Hello!\n\nClick on the follow link to Go Spot Me!\n\n"+
d)+"\n(If you are unable to click the link then copy and paste it into a browser's address bar)",c=escape(c),c="mailto:?subject=Go Spot Me!&body="+c,document.location=c)},TextSavedLocation=function(b){var c="",d="",d=null,c="",d=GetSavedLocation(b);null!=d&&!1!=VerifyLocationBitLyUrl(d)&&(d=d.BitLyUrl,c=c+("Hello!\n\nClick on the follow link to Go Spot Me!\n\n"+d)+"\n(If you are unable to click the link then copy and paste it into a browser's address bar)",c=escape(c),c=!0==IsiOS?"sms:;body="+c:"sms:?body="+
c,document.location=c)},GenerateBitLyUrl=function(b){b="https://api-ssl.bitly.com/v3/shorten?access_token=f9c1b018d84c0cad078921e196ad79b158e0184a&longUrl="+escape(b);xmlhttp=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");xmlhttp.open("GET",b,!1);xmlhttp.send();return 4==xmlhttp.readyState&&200==xmlhttp.status?(resp=JSON.parse(xmlhttp.responseText),resp.data.url):""},GetLocationBitLyUrl=function(b){var c,d="";c="&id="+b.Id;c+="&lat="+b.Pos.Lat;c+="&lng="+b.Pos.Lng;
c+="&desc="+escape(b.Desc);c+="&accuracy="+b.Accuracy;d+=WebSiteURL+"?";d+=c+"&m=";return GenerateBitLyUrl(d)},VerifyLocationBitLyUrl=function(b){b.BitLyUrl&&""!=b.BitLyUrl||(b.BitLyUrl=GetLocationBitLyUrl(b));if(""==b.BitLyUrl)return alertify.alert("Failed generating Bitly URL"),!1;SaveSavedLocations();return!0},window_OnResize=function(){var b=null,c=null,d;for(d in Maps)if(b=Maps[d])c=b.getCenter(),google.maps.event.trigger(b,"resize"),b.setCenter(c)};window.onresize=window_OnResize;